% ------------------------------------------------------------------------------
% This set of commands define the path test-output/factory the amber driver
% produces as it process YAML files.
% ------------------------------------------------------------------------------
\newcommand{\tcCsv}{}%
\newcommand{\tcCsvCap}{\tcCsv}%
\newcommand{\tcCsvResult}{}%
\newcommand{\tcCsvResultCap}{\tcCsvResult}%
\newcommand{\tcLog}{}%
\newcommand{\tcPng}{}%
\newcommand{\tcPngCap}{}%

\newboolean{MoreSteps}\setboolean{MoreSteps}{true}%
\newcounter{StepCnt}\setcounter{StepCnt}{1}%

\newboolean{MoreFiles}\setboolean{MoreFiles}{true}%
\newcounter{FileCnt}\setcounter{FileCnt}{1}%

\newcommand{\tcCsvCapData}{%
  \caption{\scriptsize\tcCsv}%
  \center{%
    \scriptsize%
    \textbf{~Step:~}\zerofill{\theStepCnt}%
    \textbf{~File:~}\zerofill{\theFileCnt}%
  }%
}%

\newcommand{\tcCsvResultCapData}{%
  \caption{\scriptsize\tcCsvResult}%
}%

\newcommand{\tcPngCapData}{%
  \caption{\scriptsize\tcPng}%
  \center{%
    \scriptsize%
    \textbf{~Step:~}\zerofill{\theStepCnt}%
    \textbf{~File:~}\zerofill{\theFileCnt}%
  }%
}%

\newcommand{\setTOFPath}[1]{%
  \renewcommand{\tcCsv}{#1-\zerofill{\theStepCnt}-\zerofill{\theFileCnt}.csv}%
  \renewcommand{\tcCsvCap}{\tcCsvCapData}%
  \renewcommand{\tcCsvResult}{#1.csv}%
  \renewcommand{\tcCsvResultCap}{\tcCsvResultCapData}%
  \renewcommand{\tcLog}{#1.tex}%
  \renewcommand{\tcPng}{#1-\zerofill{\theStepCnt}-\zerofill{\theFileCnt}.png}
  \renewcommand{\tcPngCap}{\tcPngCapData}%
}%

\newcommand{\setTOFPathC}[3]{%
  \renewcommand{\tcCsv}{#3-\zerofill{\theStepCnt}-\zerofill{\theFileCnt}.csv}%
  \renewcommand{\tcCsvCap}{\tcCsvCapData}%
  \renewcommand{\tcCsvResult}{#1.csv}%
  \renewcommand{\tcCsvResultCap}{\tcCsvResultCapData}%
  \renewcommand{\tcLog}{#3.tex}%
  \renewcommand{\tcPng}{#3-\zerofill{\theStepCnt}-\zerofill{\theFileCnt}.png}
  \renewcommand{\tcPngCap}{\tcPngCapData}%
}%


% ------------------------------------------------------------------------------
% Comma Separated Variable table definition.  This table is applicable to 1 and
% 3 argument commands.
% ------------------------------------------------------------------------------
% Define column names use by csvreader for Test Case results.
\csvnames{tcNames}{1=\id, 2=\key, 3=\des, 4=\status}%

\csvstyle{tcStyle}{%
   before reading=\small
  ,longtable=|L{1.6cm}|L{5.0cm}|L{6.5cm}|C{1.1cm}|
  ,table head=\hline\rowcolor{blue!35}REQID & RESKEY & TEXT & STATUS\ER\endhead
  ,late after line=\ER
  ,table foot=\hline
  ,tcNames
}%

% ------------------------------------------------------------------------------
% Zero fill numbers
\newcommand{\zerofill}[1]{\ifnum#1<10 00#1\else\ifnum#1<100 0#1\else #1\fi\fi}%

% ------------------------------------------------------------------------------
% These commands are used when the amber driver is directed to run a Test Plan,
% Test Suite, or Test Case that does not provide support for a web browser or
% spoken language.
%
% Test Plan, Test Suite, and Test Case one argument commands:
% #1 - filename
% ------------------------------------------------------------------------------
% Define Test Plan Output (tpo) commands.
\newcommand{\tpo}[1]{\setTOFPath{#1}\inputIfExists{#1.tex}}%

% ------------------------------------------------------------------------------
% Define Test Suite Output (tso) commands.
\newcommand{\tso}[1]{\setTOFPath{#1}\inputIfExists{#1.tex}}%

% ------------------------------------------------------------------------------
% Define Test Case Output (tco) commands.
%
% Define a command to standardize test case output (tco).
\newcommand{\tco}[1]{\setTOFPath{#1}\assembleTestCaseOutput}%

% ------------------------------------------------------------------------------
% These commands are used when the amber driver is directed to run a Test Plan,
% Test Suite, or Test Case to support a web browser and spoken language.
%
% Test Plan, Test Suite, and Test Case three argument commands:
% #1 - browser
% #2 - language
% #3 - filename
% ------------------------------------------------------------------------------
% Define Test Plan Output (tpo) commands.
\newcommand{\tpoC}[3]{\setTOFPath{#1}{#2}{#3}\inputIfExists{#3.tex}}%

% ------------------------------------------------------------------------------
% Define Test Suite Output (tso3) commands.
\newcommand{\tsoC}[3]{\setTOFPath{#1}{#2}{#3}\inputIfExists{#3.tex}}%

% ------------------------------------------------------------------------------
% Define Test Case Output (tcoC) commands.
%
% Define a command to standardize test case output (tcoC).
\newcommand{\tcoC}[3]{\setTOFPathC{#1}{#2}{#3}\assembleTestCaseOutput}%

% ------------------------------------------------------------------------------
% Include the log file Amber created.
% ------------------------------------------------------------------------------
\newcommand{\includeLogFile}{\inputIfExists{\tcLog}}%

% ------------------------------------------------------------------------------
% Include the CSV file the program Amber called created.
% ------------------------------------------------------------------------------
\newcommand{\includeCsvFile}{%
  \IfFileExists{\tcCsv}{%
    \clearpage\pagebreak%
    \begin{table}[ht]%
      \centering%
      \csvreader[tcStyle, separator=pipe]{\tcCsv}{}{\id & \key & \des & \status}%
      \tcCsvCap%
    \end{table}%
  }{}%
}%

% ------------------------------------------------------------------------------
% Include the CSV file the program Amber called created at end of the test case.
% ------------------------------------------------------------------------------
\newcommand{\includeCsvResultFile}{%
  \IfFileExists{\tcCsvResult}{%
    \clearpage\pagebreak%
    \begin{table}[ht]%
      \centering%
      \csvreader[tcStyle, separator=pipe]{\tcCsvResult}{}{\id & \key & \des & \status}%
      \tcCsvResultCap%
    \end{table}%
  }{}%
}%

% ------------------------------------------------------------------------------
% Include the PNG file the program Amber called created.
% ------------------------------------------------------------------------------
\newcommand{\includePngFile}{%
  \IfFileExists{\tcPng}{%
    \clearpage\pagebreak%
    \begin{figure}[ht]%
      \centering%
      \includegraphics[scale=0.31]{\tcPng}%
      \tcPngCap%
    \end{figure}%
    \includeCsvFile%
    \addtocounter{FileCnt}{1}%
  }%
  {% Else
    \setboolean{MoreFiles}{false}%
    \setcounter{FileCnt}{1}%
  }%
}

% ------------------------------------------------------------------------------
% Assemble test case output uses includeLogFile and includeCsvFile.
% ------------------------------------------------------------------------------
\newcommand{\assembleTestCaseOutput}{%
  %
  \includeLogFile%
  %
  \setboolean{MoreSteps}{true}%
  \setcounter{StepCnt}{1}%
  %
  \setboolean{MoreFiles}{true}%
  \setcounter{FileCnt}{1}%
  %
  \whiledo{\boolean{MoreSteps}}{%
    \setboolean{MoreFiles}{true}%
    \IfFileExists{\tcPng}{%
      \whiledo{\boolean{MoreFiles}}{%
        \includePngFile%
      }%
      \addtocounter{StepCnt}{1}%
    }%
    {% Else
      \setboolean{MoreSteps}{false}%
      \setcounter{StepCnt}{1}%
    }%
  }%
  %
  \includeCsvResultFile
  %
}%

% ------------------------------------------------------------------------------
% Initialize our directory variables to {} so LaTeX can renew them each time
% \useAutoDocFile is referenced.
\newcommand{\lDir}{}% local directory
\newcommand{\sDir}{}% boilerplateSpecificDir
\newcommand{\bDir}{}% boilerplateDir

% Refresh directory variables. 
\newcommand{\refreshDirs}[1]{%
  \renewcommand{\lDir}{#1}%
  \renewcommand{\sDir}{\boilerplateSpecificTestDir/#1}%
  \renewcommand{\bDir}{\boilerplateDir/#1}%
}

% We want to find and use a document part by searching the local directory,
% followed by the boilerPlateSpecificDir, and finally the boilerplateDir.
\newcommand{\useAutoDocFile}[1]{%
  \refreshDirs{#1}
  \IfFileExists{\lDir}{\input{\lDir}}{%
    \IfFileExists{\sDir}{\input{\sDir}}{%
      \IfFileExists{\bDir}{\input{\bDir}}{}%
    }%
  }%
}%

% ------------------------------------------------------------------------------
